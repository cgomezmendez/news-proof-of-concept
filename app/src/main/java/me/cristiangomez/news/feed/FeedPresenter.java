package me.cristiangomez.news.feed;

import org.json.JSONArray;
import org.json.JSONException;

import java.util.ArrayList;
import java.util.List;

import androidx.annotation.NonNull;
import me.cristiangomez.news.data.Story;
import me.cristiangomez.news.util.parse.StoryJsonParser;

public class FeedPresenter implements FeedContract.Presenter {
    private final FeedContract.View feedView;

    public FeedPresenter(@NonNull  FeedContract.View feedView) {
        this.feedView = feedView;
        feedView.setPresenter(this);
    }

    @Override
    public void loadStories() {
        // TODO: implement logic
        List<Story> stories = new ArrayList<>();
        String dummyStories = "[{\"id\":\"politics/2018/jul/04/jaguar-land-rovers-80bn-uk-investment-plan-at-risk-after-hard-brexit\",\"type\":\"article\",\"sectionId\":\"politics\",\"sectionName\":\"Politics\",\"webPublicationDate\":\"2018-07-04T22:34:12Z\",\"webTitle\":\"Jaguar Land Rover's £80bn UK investment plan at risk after hard Brexit\",\"webUrl\":\"https://www.theguardian.com/politics/2018/jul/04/jaguar-land-rovers-80bn-uk-investment-plan-at-risk-after-hard-brexit\",\"apiUrl\":\"https://content.guardianapis.com/politics/2018/jul/04/jaguar-land-rovers-80bn-uk-investment-plan-at-risk-after-hard-brexit\",\"fields\":{\"headline\":\"Jaguar Land Rover's £80bn UK investment plan at risk after hard Brexit\",\"trailText\":\"Firm says its 40,000 employees and five-year investment plan are in jeopardy from uncertainty\",\"byline\":\"Kevin Rawlinson\",\"lastModified\":\"2018-07-04T22:36:13Z\",\"thumbnail\":\"https://media.guim.co.uk/b9a2db24c4dcd20d317bccead23fc5149e0c2b85/196_488_4845_2907/500.jpg\"},\"isHosted\":false,\"pillarId\":\"pillar/news\",\"pillarName\":\"News\"},{\"id\":\"stage/2018/jul/04/the-lieutenant-of-inishmore-review-aidan-turner-martin-mcdonagh\",\"type\":\"article\",\"sectionId\":\"stage\",\"sectionName\":\"Stage\",\"webPublicationDate\":\"2018-07-04T22:00:13Z\",\"webTitle\":\"The Lieutenant of Inishmore review – Aidan Turner is terrific in shocking comedy\",\"webUrl\":\"https://www.theguardian.com/stage/2018/jul/04/the-lieutenant-of-inishmore-review-aidan-turner-martin-mcdonagh\",\"apiUrl\":\"https://content.guardianapis.com/stage/2018/jul/04/the-lieutenant-of-inishmore-review-aidan-turner-martin-mcdonagh\",\"fields\":{\"headline\":\"The Lieutenant of Inishmore review – Aidan Turner is terrific in shocking comedy\",\"trailText\":\"The Poldark star gives an excellent performance in a first-rate revival of Martin McDonagh’s brutally funny play\",\"byline\":\"Michael Billington\",\"lastModified\":\"2018-07-04T22:35:05Z\",\"thumbnail\":\"https://media.guim.co.uk/c6df45dfde36806a97da5ecba45b49c6d8785879/0_17_5194_3117/500.jpg\"},\"isHosted\":false,\"pillarId\":\"pillar/arts\",\"pillarName\":\"Arts\"},{\"id\":\"uk-news/2018/jul/04/why-has-wiltshire-couples-health-led-to-cobra-emergency-meeting\",\"type\":\"article\",\"sectionId\":\"uk-news\",\"sectionName\":\"UK news\",\"webPublicationDate\":\"2018-07-04T21:57:00Z\",\"webTitle\":\"Questions raised by the second Wiltshire nerve agent poisoning\",\"webUrl\":\"https://www.theguardian.com/uk-news/2018/jul/04/why-has-wiltshire-couples-health-led-to-cobra-emergency-meeting\",\"apiUrl\":\"https://content.guardianapis.com/uk-news/2018/jul/04/why-has-wiltshire-couples-health-led-to-cobra-emergency-meeting\",\"fields\":{\"headline\":\"Questions raised by the second Wiltshire nerve agent poisoning\",\"trailText\":\"Event declared a ‘major incident’ even before novichok confirmation was made\",\"byline\":\"Ewen MacAskill\",\"lastModified\":\"2018-07-04T22:36:48Z\",\"thumbnail\":\"https://media.guim.co.uk/04925fbc6f6899d410725b3647d8395d3958ec18/0_233_3500_2100/500.jpg\"},\"isHosted\":false,\"pillarId\":\"pillar/news\",\"pillarName\":\"News\"},{\"id\":\"us-news/2018/jul/04/stormy-daniels-michael-avenatti-donald-trump-2020-election\",\"type\":\"article\",\"sectionId\":\"us-news\",\"sectionName\":\"US news\",\"webPublicationDate\":\"2018-07-04T21:42:46Z\",\"webTitle\":\"Stormy Daniels' lawyer Michael Avenatti suggests run against Trump in 2020\",\"webUrl\":\"https://www.theguardian.com/us-news/2018/jul/04/stormy-daniels-michael-avenatti-donald-trump-2020-election\",\"apiUrl\":\"https://content.guardianapis.com/us-news/2018/jul/04/stormy-daniels-michael-avenatti-donald-trump-2020-election\",\"fields\":{\"headline\":\"Stormy Daniels' lawyer Michael Avenatti suggests run against Trump in 2020\",\"trailText\":\"‘IF (big) he seeks re-election, I will run, but only if I think that there is no candidate that has a REAL chance at beating him’\",\"byline\":\"Jamiles Lartey in New Orleans\",\"lastModified\":\"2018-07-04T22:00:57Z\",\"thumbnail\":\"https://media.guim.co.uk/17dd5960f2a9f91582a6450cba3e421316249fbe/0_91_2720_1632/500.jpg\"},\"isHosted\":false,\"pillarId\":\"pillar/news\",\"pillarName\":\"News\"},{\"id\":\"football/2018/jul/04/harry-kane-england-sweden-jamie-vardy-fit\",\"type\":\"article\",\"sectionId\":\"football\",\"sectionName\":\"Football\",\"webPublicationDate\":\"2018-07-04T21:30:13Z\",\"webTitle\":\"Harry Kane reports fit for Sweden but Jamie Vardy gives cause for concern\",\"webUrl\":\"https://www.theguardian.com/football/2018/jul/04/harry-kane-england-sweden-jamie-vardy-fit\",\"apiUrl\":\"https://content.guardianapis.com/football/2018/jul/04/harry-kane-england-sweden-jamie-vardy-fit\",\"fields\":{\"headline\":\"Harry Kane reports fit for Sweden but Jamie Vardy gives cause for concern\",\"trailText\":\"Gareth Southgate’s fears over the fitness of Harry Kane have been allayed following his team’s bruising knockout success over Colombia\",\"byline\":\"Dominic Fifield in St Petersburg\",\"lastModified\":\"2018-07-04T21:30:13Z\",\"thumbnail\":\"https://media.guim.co.uk/696ec8fe328380f22fcae6e05047c6bdf4cccb67/0_131_3261_1956/500.jpg\"},\"isHosted\":false,\"pillarId\":\"pillar/sport\",\"pillarName\":\"Sport\"},{\"id\":\"football/2018/jul/04/emil-krafth-sweden-ashley-young\",\"type\":\"article\",\"sectionId\":\"football\",\"sectionName\":\"Football\",\"webPublicationDate\":\"2018-07-04T21:30:13Z\",\"webTitle\":\"Emil Krafth says Sweden will be wary of Ashley Young’s diving\",\"webUrl\":\"https://www.theguardian.com/football/2018/jul/04/emil-krafth-sweden-ashley-young\",\"apiUrl\":\"https://content.guardianapis.com/football/2018/jul/04/emil-krafth-sweden-ashley-young\",\"fields\":{\"headline\":\"Emil Krafth says Sweden will be wary of Ashley Young’s diving\",\"trailText\":\"Sweden will be on alert for the penalty box diving of the England wing-back Ashley Young in Saturday’s World Cup quarter-final, according to a member of Janne Andersson’s squad\",\"byline\":\"David Hytner in Moscow\",\"lastModified\":\"2018-07-04T21:30:13Z\"},\"isHosted\":false,\"pillarId\":\"pillar/sport\",\"pillarName\":\"Sport\"},{\"id\":\"football/2018/jul/04/jordan-henderson-jordan-pickford-england-heroics-penalties\",\"type\":\"article\",\"sectionId\":\"football\",\"sectionName\":\"Football\",\"webPublicationDate\":\"2018-07-04T21:30:13Z\",\"webTitle\":\"Jordan Henderson ‘cannot thank Jordan Pickford enough’ for England heroics\",\"webUrl\":\"https://www.theguardian.com/football/2018/jul/04/jordan-henderson-jordan-pickford-england-heroics-penalties\",\"apiUrl\":\"https://content.guardianapis.com/football/2018/jul/04/jordan-henderson-jordan-pickford-england-heroics-penalties\",\"fields\":{\"headline\":\"Jordan Henderson ‘cannot thank Jordan Pickford enough’ for England heroics\",\"trailText\":\"Jordan Henderson has admitted he will be forever in Jordan Pickford’s debt after his teammate’s eye-catching save from Carlos Bacca set up England’s shootout win over Colombia\",\"byline\":\"Dominic Fifield in St Petersburg\",\"lastModified\":\"2018-07-04T21:30:13Z\",\"thumbnail\":\"https://media.guim.co.uk/d4d544f5e1166bd3aa8a8945fd96f91e8af62616/45_76_1333_799/500.jpg\"},\"isHosted\":false,\"pillarId\":\"pillar/sport\",\"pillarName\":\"Sport\"},{\"id\":\"tv-and-radio/2018/jul/04/rich-halls-working-for-the-american-dream-review-sigmund-freud-in-a-cowboy-hat\",\"type\":\"article\",\"sectionId\":\"tv-and-radio\",\"sectionName\":\"Television & radio\",\"webPublicationDate\":\"2018-07-04T21:30:13Z\",\"webTitle\":\"Rich Hall’s Working for the American Dream review: he’s Sigmund Freud in a cowboy hat\",\"webUrl\":\"https://www.theguardian.com/tv-and-radio/2018/jul/04/rich-halls-working-for-the-american-dream-review-sigmund-freud-in-a-cowboy-hat\",\"apiUrl\":\"https://content.guardianapis.com/tv-and-radio/2018/jul/04/rich-halls-working-for-the-american-dream-review-sigmund-freud-in-a-cowboy-hat\",\"fields\":{\"headline\":\"Rich Hall’s Working for the American Dream review – Sigmund Freud in a cowboy hat\",\"trailText\":\"The comedian meanders over the Mason-Dixon Line in his attempt to pin down the abstract concept that binds the US together\",\"byline\":\"Sam Wollaston\",\"lastModified\":\"2018-07-04T21:30:13Z\",\"thumbnail\":\"https://media.guim.co.uk/fcffe7431e37a635e47d15f17386d126ca291b9c/80_0_2380_1428/500.jpg\"},\"isHosted\":false,\"pillarId\":\"pillar/arts\",\"pillarName\":\"Arts\"},{\"id\":\"football/2018/jul/04/gareth-southgate-england-reason-to-believe-daniel-taylor\",\"type\":\"article\",\"sectionId\":\"football\",\"sectionName\":\"Football\",\"webPublicationDate\":\"2018-07-04T21:30:13Z\",\"webTitle\":\"Gareth Southgate’s England shed old baggage and offer reason to believe | Daniel Taylor\",\"webUrl\":\"https://www.theguardian.com/football/2018/jul/04/gareth-southgate-england-reason-to-believe-daniel-taylor\",\"apiUrl\":\"https://content.guardianapis.com/football/2018/jul/04/gareth-southgate-england-reason-to-believe-daniel-taylor\",\"fields\":{\"headline\":\"Gareth Southgate’s England shed old baggage and offer reason to believe\",\"trailText\":\"England’s cautious optimism under Gareth Southgate is rooted in a new humility and work ethic rather than the arrogance with which recent sides have so often been associated\",\"byline\":\"Daniel Taylor in St Petersburg\",\"lastModified\":\"2018-07-04T21:30:13Z\",\"thumbnail\":\"https://media.guim.co.uk/9e1738a44e1eae8c9f31debe03293039bea4d342/0_30_3000_1800/500.jpg\"},\"isHosted\":false,\"pillarId\":\"pillar/sport\",\"pillarName\":\"Sport\"},{\"id\":\"sport/2018/jul/04/kyle-edmund-swedish-coach-klahn-world-cup-rivalry\",\"type\":\"article\",\"sectionId\":\"sport\",\"sectionName\":\"Sport\",\"webPublicationDate\":\"2018-07-04T21:30:13Z\",\"webTitle\":\"Kyle Edmund and Swedish coach focus on Klahn before World Cup\",\"webUrl\":\"https://www.theguardian.com/sport/2018/jul/04/kyle-edmund-swedish-coach-klahn-world-cup-rivalry\",\"apiUrl\":\"https://content.guardianapis.com/sport/2018/jul/04/kyle-edmund-swedish-coach-klahn-world-cup-rivalry\",\"fields\":{\"headline\":\"Kyle Edmund and Swedish coach focus on Klahn before World Cup\",\"trailText\":\"Kyle Edmund is preparing to face the Californian Bradley Klahn in the second round before the World Cup separates him from his Swedish coach, Fredrik Rosengren, briefly on Saturday\",\"byline\":\"Kevin Mitchell at Wimbledon\",\"lastModified\":\"2018-07-04T21:30:13Z\",\"thumbnail\":\"https://media.guim.co.uk/1ad2d99dfc7836dd19334e0ef242b5e4259997f1/0_27_1600_960/500.jpg\"},\"isHosted\":false,\"pillarId\":\"pillar/sport\",\"pillarName\":\"Sport\"}]";
        StoryJsonParser storyJsonParser = new StoryJsonParser();
        try {
            JSONArray jsonArray = new JSONArray(dummyStories);
            for (int i = 0; i < jsonArray.length(); i++) {
                stories.add(storyJsonParser.parseJson(jsonArray.getJSONObject(i)));
            }
        } catch (JSONException e) {
            e.printStackTrace();
        }
        this.feedView.showStories(stories);
    }

    @Override
    public void openStoryDetails(@NonNull Story requestedStory) {
        // TODO: implement logic
    }

    @Override
    public void start() {
        loadStories();
    }
}
